# ==============================================================================
# Ref: "Alpha 101"
# # Alpha#19:         
#                       (Y): -1 * delta(high, 2)
#                       /
#                      /
# sum[ high, 20] / high
#                      \
#                       \
#                       (N): 0
# #
# 算法
# 1.
#
# 含义
# 本质上说，判断开盘价的异常，如果与上一天的 high,close,low，都是显著的差异，则发出做款指令
#        也就是所，对于开盘价格，判断其会回归 

# 关联：
# 
# ==============================================================================

# ------------------------------------------------------------------------------
## Alpha Name
alphaName <- 'alpha101_23'

## 需要去除的日期
truncatedTD <- 20
# ------------------------------------------------------------------------------

# ==========: 提取dtX ===============================================================================
# ------------------------------------------------------------------------------
# dtX
# ------------------------------------------------------------------------------ 

# ------------------------------------------------------------------------------
# 计算 signal

# ------------------------------------------------------------------------------
dtX <- inSample[, .SD[.N > truncatedTD]
                , by = 'InstrumentID'] %>%
        .[, ":="(meanHigh = c(rep(NA,truncatedTD),rollmean(high,truncatedTD)))
          , by = 'InstrumentID'] %>%
        .[!is.na(meanHigh)] %>%
        .[,mySignal := ifelse(meanHigh < high,
                              high - shift(high,2L,type='lag'),
                              0)
          ,by = 'InstrumentID'] %>%
        .[!is.na(mySignal)]
# ==================================================================================================
