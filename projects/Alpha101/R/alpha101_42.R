# ==============================================================================
# Ref: "Alpha 101"
# # Alpha#42:

# rank[ vwap - close ] / 
# rank[ vwap + close]

# #
# 算法
# 1.
#
# 含义
# 判断 high 和 low 的几何平均，与 vwap
# 追踪趋势

# 关联：
# 
# ==============================================================================

# ------------------------------------------------------------------------------
## Alpha Name
alphaName <- 'alpha101_42'

## 需要去除的日期
truncatedTD <- 0
# ------------------------------------------------------------------------------


# ==========: 提取dtX ===============================================================================
# ------------------------------------------------------------------------------
# dtX
# ------------------------------------------------------------------------------ 

# ------------------------------------------------------------------------------
# 计算 signal

# ------------------------------------------------------------------------------

dtX <- inSample[, .SD[.N > truncatedTD]
                , by = 'InstrumentID'] %>%
        .[,":="(signal1 = base::rank(vwap - close, ties.method = 'max'),
                signal2 = base::rank(vwap + close, ties.method = 'max'))
          , by = 'TradingDay'] %>%
        .[, mySignal := signal1 / signal2] %>% 
        .[, mySignal := (mySignal - mean(mySignal)) / sd(mySignal) * sqrt(row(.SD))
          , by = 'TradingDay']
         

# ==================================================================================================
